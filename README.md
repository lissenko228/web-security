# web-security

Выполнил: Корепанов Владислав ДИС-213/21.Б

## 1 практическая (practice_1)

### Файл auth.js

В файле auth.js есть метод auth: принимает request и response.

В req.body находятся email (почта), password (пароль), rememberCheck (запомнить вход).

В константу user записываем значение, которое получили из БД.

Если пользователя с таким email не существует, то возвращаем 403 статус.

Затем получаем роли пользователя через getter.

После этого сверяем пароль который отправил пользователь с его кешем с помощью функции compare.

Если пароль неверный возвращаем 403 статус.

Затем генерируем accessToken - токен авторизации и refreshToken - токен для сброса пароля.

Токены генерируются с помощью библиотеки jwt для nodeJS и функции sign.

В конечном итоге возвращаем пользователя и токены.

![image](https://github.com/lissenko228/web-security/assets/73995545/609cbea9-3dfc-43e1-b506-fbc7497ca4b0)


### Файл middleware.js

В этом файле есть два мидлвеера user и admin, которые получают авторизацию из заголовков.

Потом через функцию verify библиотеки jwt, которая принимает bearer token, секрет - (набор символов при помощи которого шифруется jwt) и callback.

В стрелочной функции получаем ошибки и объект, который содержит расшифрованные данные.

Затем делаем проверку на ошибки и ищем пользователя из расшифрованных данных в БД.

Если ошибок нет и пользователь найден пропускаем дальше.

В функции admin идет та же проверка, только дополнительно проверяем наличие роли с доступом 1.

## 2 практическая (practice_2)

В файле auth.js реализована проверка авторизации через params функция принимает токен, который находится в параметрах запроса.

```
const { bearer } = req.params;
```

Затем идет проверка токена через jwt verify, в которой проверяется наличие ошибок и существование пользователя в БД.

Если ошибок нет, то возвращаем пользователя

![image](https://github.com/lissenko228/web-security/assets/73995545/0a589c93-3e6c-4911-b4ed-8d0a8eab2884)

